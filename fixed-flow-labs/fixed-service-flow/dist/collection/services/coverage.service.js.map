{"version":3,"file":"coverage.service.js","sourceRoot":"","sources":["../../src/services/coverage.service.ts"],"names":[],"mappings":"AAAA,+CAA+C;AAC/C,kDAAkD;AAClD,mCAAmC;AACnC,+CAA+C;AAE/C,OAAO,EAAE,WAAW,EAAE,MAAM,gBAAgB,CAAC;AAC7C,OAAO,EAAE,YAAY,EAAE,MAAM,iBAAiB,CAAC;AAC/C,OAAO,EAAkC,gBAAgB,EAAE,MAAM,qBAAqB,CAAC;AAEvF,6CAA6C;AAC7C,yBAAyB;AACzB,6CAA6C;AAE7C,MAAM,eAAe;IACnB,6CAA6C;IAC7C,oBAAoB;IACpB,6CAA6C;IAE7C;;;OAGG;IACH,KAAK,CAAC,gBAAgB,CAAC,QAAgB,EAAE,SAAiB;QACxD,6CAA6C;QAC7C,MAAM,YAAY,CAAC,WAAW,EAAE,CAAC;QAEjC,MAAM,QAAQ,GAAG,MAAM,WAAW,CAAC,IAAI,CAAmB,gCAAgC,EAAE;YAC1F,OAAO,EAAE,MAAM,CAAC,QAAQ,CAAC;YACzB,QAAQ,EAAE,MAAM,CAAC,SAAS,CAAC;SAC5B,CAAC,CAAC;QAEH,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED,6CAA6C;IAC7C,yCAAyC;IACzC,6CAA6C;IAE7C;;OAEG;IACH,KAAK,CAAC,aAAa,CACjB,QAAgB,EAChB,SAAiB,EACjB,OAAe,EACf,IAAY,EACZ,OAAe;QAEf,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAElE,mBAAmB;QACnB,IAAI,QAAQ,CAAC,QAAQ,EAAE,CAAC;YACtB,OAAO;gBACL,QAAQ;gBACR,SAAS;gBACT,OAAO;gBACP,IAAI;gBACJ,OAAO;gBACP,WAAW,EAAE,EAAE;gBACf,cAAc,EAAE,gBAAgB,CAAC,WAAW;gBAC5C,OAAO,EAAE,KAAK;aACf,CAAC;QACJ,CAAC;QAED,2BAA2B;QAC3B,MAAM,WAAW,GAAG,QAAQ,CAAC,eAAe,CAAC;QAE7C,2BAA2B;QAC3B,IAAI,cAAc,GAAG,gBAAgB,CAAC,WAAW,CAAC;QAClD,IAAI,QAAQ,CAAC,UAAU,IAAI,QAAQ,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC1D,MAAM,iBAAiB,GAAG,QAAQ,CAAC,UAAU,CAAC,IAAI,CAChD,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,YAAY,KAAK,WAAW,CAC1C,CAAC;YACF,IAAI,iBAAiB,EAAE,CAAC;gBACtB,cAAc,GAAG,iBAAiB,CAAC,eAAe,CAAC;YACrD,CAAC;QACH,CAAC;QAED,6CAA6C;QAC7C,MAAM,iBAAiB,GAAG,CAAC,MAAM,EAAE,MAAM,EAAE,aAAa,CAAC,CAAC;QAC1D,MAAM,OAAO,GAAG,iBAAiB,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QAExD,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,OAAO;gBACL,QAAQ;gBACR,SAAS;gBACT,OAAO;gBACP,IAAI;gBACJ,OAAO;gBACP,WAAW,EAAE,EAAE;gBACf,cAAc,EAAE,gBAAgB,CAAC,WAAW;gBAC5C,OAAO,EAAE,KAAK;aACf,CAAC;QACJ,CAAC;QAED,OAAO,CAAC,GAAG,CAAC,4CAA4C,CAAC,CAAC;QAC1D,OAAO;YACL,QAAQ;YACR,SAAS;YACT,OAAO;YACP,IAAI;YACJ,OAAO;YACP,WAAW;YACX,cAAc;YACd,OAAO,EAAE,IAAI;SACd,CAAC;IACJ,CAAC;IAED,6CAA6C;IAC7C,gCAAgC;IAChC,6CAA6C;IAE7C;;OAEG;IACH,qBAAqB,CAAC,WAAmB;QACvC,MAAM,YAAY,GAA2B;YAC3C,IAAI,EAAE,cAAc;YACpB,IAAI,EAAE,cAAc;YACpB,aAAa,EAAE,sBAAsB;SACtC,CAAC;QACF,OAAO,YAAY,CAAC,WAAW,CAAC,IAAI,WAAW,CAAC;IAClD,CAAC;IAED,6CAA6C;IAC7C,kDAAkD;IAClD,6CAA6C;IAE7C;;OAEG;IACH,YAAY,CAAC,WAAmB;QAC9B,OAAO,WAAW,CAAC,WAAW,EAAE,KAAK,aAAa,CAAC;IACrD,CAAC;CACF;AAED,6CAA6C;AAC7C,mBAAmB;AACnB,6CAA6C;AAE7C,MAAM,CAAC,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAC;AACrD,eAAe,eAAe,CAAC","sourcesContent":["// ============================================\n// COVERAGE SERVICE - Location Coverage Validation\n// Fixed Service Flow Web Component\n// ============================================\n\nimport { httpService } from './http.service';\nimport { tokenService } from './token.service';\nimport { CoverageResponse, LocationData, SERVICE_MESSAGES } from '../store/interfaces';\n\n// ------------------------------------------\n// COVERAGE SERVICE CLASS\n// ------------------------------------------\n\nclass CoverageService {\n  // ------------------------------------------\n  // VALIDATE COVERAGE\n  // ------------------------------------------\n\n  /**\n   * Validates coverage for a given location\n   * Endpoint: POST api/Catalogue/getInternetPlans\n   */\n  async validateCoverage(latitude: number, longitude: number): Promise<CoverageResponse> {\n    // Ensure token exists before making the call\n    await tokenService.ensureToken();\n\n    const response = await httpService.post<CoverageResponse>('api/Catalogue/getInternetPlans', {\n      latitud: String(latitude),\n      longitud: String(longitude),\n    });\n\n    return response;\n  }\n\n  // ------------------------------------------\n  // CHECK COVERAGE AND BUILD LOCATION DATA\n  // ------------------------------------------\n\n  /**\n   * Checks coverage and returns structured location data\n   */\n  async checkCoverage(\n    latitude: number,\n    longitude: number,\n    address: string,\n    city: string,\n    zipCode: string,\n  ): Promise<LocationData> {\n    const response = await this.validateCoverage(latitude, longitude);\n\n    // Check for errors\n    if (response.hasError) {\n      return {\n        latitude,\n        longitude,\n        address,\n        city,\n        zipCode,\n        serviceType: '',\n        serviceMessage: SERVICE_MESSAGES.NO_COVERAGE,\n        isValid: false,\n      };\n    }\n\n    // Get the priority service\n    const serviceType = response.priorityService;\n\n    // Find the service message\n    let serviceMessage = SERVICE_MESSAGES.NO_COVERAGE;\n    if (response.attributes && response.attributes.length > 0) {\n      const priorityAttribute = response.attributes.find(\n        attr => attr.servicE_NAME === serviceType,\n      );\n      if (priorityAttribute) {\n        serviceMessage = priorityAttribute.servicE_MESSAGE;\n      }\n    }\n\n    // Validate that we have a valid service type\n    const validServiceTypes = ['GPON', 'VRAD', 'CLARO HOGAR'];\n    const isValid = validServiceTypes.includes(serviceType);\n\n    if (!isValid) {\n      return {\n        latitude,\n        longitude,\n        address,\n        city,\n        zipCode,\n        serviceType: '',\n        serviceMessage: SERVICE_MESSAGES.NO_COVERAGE,\n        isValid: false,\n      };\n    }\n\n    console.log('[CoverageService] Returning valid coverage');\n    return {\n      latitude,\n      longitude,\n      address,\n      city,\n      zipCode,\n      serviceType,\n      serviceMessage,\n      isValid: true,\n    };\n  }\n\n  // ------------------------------------------\n  // GET SERVICE TYPE DISPLAY NAME\n  // ------------------------------------------\n\n  /**\n   * Gets a user-friendly display name for the service type\n   */\n  getServiceDisplayName(serviceType: string): string {\n    const displayNames: Record<string, string> = {\n      GPON: 'Fibra Óptica',\n      VRAD: 'Internet DSL',\n      'CLARO HOGAR': 'Internet Inalámbrico',\n    };\n    return displayNames[serviceType] || serviceType;\n  }\n\n  // ------------------------------------------\n  // CHECK IF SERVICE TYPE REQUIRES SPECIAL HANDLING\n  // ------------------------------------------\n\n  /**\n   * Checks if the service type is CLARO HOGAR (requires different flow)\n   */\n  isClaroHogar(serviceType: string): boolean {\n    return serviceType.toLowerCase() === 'claro hogar';\n  }\n}\n\n// ------------------------------------------\n// SINGLETON EXPORT\n// ------------------------------------------\n\nexport const coverageService = new CoverageService();\nexport default coverageService;\n"]}