{"version":3,"file":"http.service.js","sourceRoot":"","sources":["../../src/services/http.service.ts"],"names":[],"mappings":"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","sourcesContent":["// ============================================\n// HTTP SERVICE - Base HTTP Client\n// Fixed Service Flow Web Component\n// ============================================\n\nimport { flowState } from '../store/flow.store';\n\n// ------------------------------------------\n// TYPES\n// ------------------------------------------\n\nexport interface HttpRequestConfig {\n  method: 'GET' | 'POST' | 'PUT' | 'DELETE';\n  endpoint: string;\n  body?: unknown;\n  headers?: Record<string, string>;\n  timeout?: number;\n  isFormData?: boolean;\n}\n\nexport interface HttpResponse<T = unknown> {\n  data: T;\n  status: number;\n  ok: boolean;\n}\n\nexport class HttpError extends Error {\n  constructor(\n    message: string,\n    public status: number,\n    public response?: unknown,\n  ) {\n    super(message);\n    this.name = 'HttpError';\n  }\n}\n\n// ------------------------------------------\n// HTTP SERVICE CLASS\n// ------------------------------------------\n\nexport class HttpService {\n  private baseUrl: string = '';\n  private defaultTimeout: number = 60000; // 60 seconds\n\n  // ------------------------------------------\n  // CONFIGURATION\n  // ------------------------------------------\n\n  setBaseUrl(url: string): void {\n    // Remove trailing slash\n    this.baseUrl = url.replace(/\\/$/, '');\n  }\n\n  getBaseUrl(): string {\n    return this.baseUrl;\n  }\n\n  setTimeout(timeout: number): void {\n    this.defaultTimeout = timeout;\n  }\n\n  // ------------------------------------------\n  // HEADERS\n  // ------------------------------------------\n\n  private getHeaders(customHeaders?: Record<string, string>, isFormData?: boolean): Headers {\n    const headers = new Headers();\n\n    // Don't set Content-Type for FormData (browser sets it with boundary)\n    if (!isFormData) {\n      headers.set('Content-Type', 'application/json');\n    }\n\n    // Add authentication headers if token exists\n    const token = flowState.token || sessionStorage.getItem('token');\n    const correlationId = flowState.correlationId || sessionStorage.getItem('correlationId');\n\n    if (token) {\n      headers.set('Authorization', `Bearer ${token}`);\n    }\n\n    if (correlationId) {\n      headers.set('X-Correlation-ID', correlationId);\n    }\n\n    // Add app headers\n    headers.set('App', 'shop');\n    headers.set('Platform', 'web');\n\n    // Add custom headers\n    if (customHeaders) {\n      Object.entries(customHeaders).forEach(([key, value]) => {\n        headers.set(key, value);\n      });\n    }\n\n    return headers;\n  }\n\n  // ------------------------------------------\n  // REQUEST METHOD\n  // ------------------------------------------\n\n  async request<T>(config: HttpRequestConfig): Promise<HttpResponse<T>> {\n    const { method, endpoint, body, headers: customHeaders, timeout, isFormData } = config;\n\n    // Ensure proper URL construction with slash between baseUrl and endpoint\n    const normalizedEndpoint = endpoint.startsWith('/') ? endpoint : `/${endpoint}`;\n    const url = `${this.baseUrl}${normalizedEndpoint}`;\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeout || this.defaultTimeout);\n\n    try {\n      const fetchConfig: RequestInit = {\n        method,\n        headers: this.getHeaders(customHeaders, isFormData),\n        signal: controller.signal,\n      };\n\n      // Add body for non-GET requests\n      if (body && method !== 'GET') {\n        if (isFormData && body instanceof FormData) {\n          fetchConfig.body = body;\n        } else {\n          fetchConfig.body = JSON.stringify(body);\n        }\n      }\n\n      const response = await fetch(url, fetchConfig);\n      clearTimeout(timeoutId);\n\n      // Parse response\n      let data: T;\n      const contentType = response.headers.get('content-type');\n\n      // Get raw text first to handle all cases\n      // (some servers like Claro's API return text/plain for JSON responses)\n      const rawText = await response.text();\n\n      // Try to parse as JSON regardless of content-type\n      if (rawText && (rawText.startsWith('{') || rawText.startsWith('['))) {\n        try {\n          data = JSON.parse(rawText);\n        } catch {\n          // Not valid JSON, use as text\n          data = rawText as unknown as T;\n        }\n      } else if (contentType && contentType.includes('application/json')) {\n        try {\n          data = JSON.parse(rawText);\n        } catch {\n          data = rawText as unknown as T;\n        }\n      } else {\n        data = rawText as unknown as T;\n      }\n\n      // Handle HTTP errors\n      if (!response.ok) {\n        throw new HttpError(\n          `HTTP Error: ${response.status} ${response.statusText}`,\n          response.status,\n          data,\n        );\n      }\n\n      return {\n        data,\n        status: response.status,\n        ok: response.ok,\n      };\n    } catch (error) {\n      clearTimeout(timeoutId);\n\n      if (error instanceof HttpError) {\n        throw error;\n      }\n\n      if (error.name === 'AbortError') {\n        throw new HttpError('Request timeout', 408);\n      }\n\n      throw new HttpError(error.message || 'Network error', 0);\n    }\n  }\n\n  // ------------------------------------------\n  // CONVENIENCE METHODS\n  // ------------------------------------------\n\n  async get<T>(endpoint: string, headers?: Record<string, string>): Promise<T> {\n    const response = await this.request<T>({\n      method: 'GET',\n      endpoint,\n      headers,\n    });\n    return response.data;\n  }\n\n  async post<T>(endpoint: string, body?: unknown, headers?: Record<string, string>): Promise<T> {\n    const response = await this.request<T>({\n      method: 'POST',\n      endpoint,\n      body,\n      headers,\n    });\n    return response.data;\n  }\n\n  async postFormData<T>(endpoint: string, formData: FormData, headers?: Record<string, string>): Promise<T> {\n    const response = await this.request<T>({\n      method: 'POST',\n      endpoint,\n      body: formData,\n      headers,\n      isFormData: true,\n    });\n    return response.data;\n  }\n\n  async put<T>(endpoint: string, body?: unknown, headers?: Record<string, string>): Promise<T> {\n    const response = await this.request<T>({\n      method: 'PUT',\n      endpoint,\n      body,\n      headers,\n    });\n    return response.data;\n  }\n\n  async delete<T>(endpoint: string, headers?: Record<string, string>): Promise<T> {\n    const response = await this.request<T>({\n      method: 'DELETE',\n      endpoint,\n      headers,\n    });\n    return response.data;\n  }\n}\n\n// ------------------------------------------\n// SINGLETON EXPORT\n// ------------------------------------------\n\nexport const httpService = new HttpService();\nexport default httpService;\n"]}