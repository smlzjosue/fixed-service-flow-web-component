{"version":3,"file":"step-contract.js","sourceRoot":"","sources":["../../../../src/components/steps/step-contract/step-contract.tsx"],"names":[],"mappings":"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","sourcesContent":["// ============================================\n// STEP CONTRACT - Contract Type Selection\n// Fixed Service Flow Web Component\n// ============================================\n\nimport { Component, Prop, State, h, Host } from '@stencil/core';\nimport { flowState, flowActions } from '../../../store/flow.store';\nimport { CONTRACT_OPTIONS, SelectedContract, ContractTypeId, ContractOption } from '../../../store/interfaces';\nimport { formatPrice } from '../../../utils/formatters';\n\n@Component({\n  tag: 'step-contract',\n  styleUrl: 'step-contract.scss',\n  shadow: true,\n})\nexport class StepContract {\n  // ------------------------------------------\n  // PROPS\n  // ------------------------------------------\n\n  @Prop() onNext: () => void;\n  @Prop() onBack: () => void;\n\n  // ------------------------------------------\n  // STATE\n  // ------------------------------------------\n\n  @State() activeTab: ContractTypeId = 1; // 1 = Con contrato\n  @State() selectedOption: SelectedContract | null = null;\n\n  // ------------------------------------------\n  // LIFECYCLE\n  // ------------------------------------------\n\n  componentWillLoad() {\n    // Restaurar selección previa si existe (cuando el usuario vuelve a este paso)\n    this.restorePreviousSelection();\n  }\n\n  // ------------------------------------------\n  // METHODS\n  // ------------------------------------------\n\n  /**\n   * Restaura la selección previa desde el store o sessionStorage\n   * Esto permite mantener la selección cuando el usuario navega hacia atrás\n   */\n  private restorePreviousSelection() {\n    // Primero intentar desde el store\n    if (flowState.selectedContract) {\n      this.selectedOption = flowState.selectedContract;\n      this.activeTab = flowState.selectedContract.typeId;\n      return;\n    }\n\n    // Si no está en el store, intentar desde sessionStorage\n    const typeContractId = sessionStorage.getItem('typeContractId');\n    if (typeContractId !== null) {\n      const typeId = parseInt(typeContractId) as ContractTypeId;\n      const deadlines = parseInt(sessionStorage.getItem('contractInstallment') || '0');\n      const installation = parseInt(sessionStorage.getItem('contractInstallation') || '0');\n      const activation = parseInt(sessionStorage.getItem('contractActivation') || '0');\n      const modem = parseInt(sessionStorage.getItem('contractModen') || '0');\n\n      const contractType = CONTRACT_OPTIONS.find(c => c.typeId === typeId);\n\n      this.selectedOption = {\n        typeId,\n        typeName: contractType?.type || '',\n        deadlines,\n        installation,\n        activation,\n        modem,\n      };\n      this.activeTab = typeId;\n\n      // Sincronizar con el store\n      flowActions.setContract(this.selectedOption);\n    }\n  }\n\n  private handleTabChange = (typeId: ContractTypeId) => {\n    this.activeTab = typeId;\n    // No limpiar la selección si ya hay una del mismo tipo\n    if (this.selectedOption?.typeId !== typeId) {\n      this.selectedOption = null;\n    }\n  };\n\n  private handleSelectOption = (typeId: ContractTypeId, option: any) => {\n    const contractType = CONTRACT_OPTIONS.find(c => c.typeId === typeId);\n\n    this.selectedOption = {\n      typeId,\n      typeName: contractType?.type || '',\n      deadlines: option.deadlines,\n      installation: option.installation,\n      activation: option.activation,\n      modem: option.modem,\n    };\n\n    flowActions.setContract(this.selectedOption);\n  };\n\n  private handleContinue = () => {\n    if (this.selectedOption) {\n      this.onNext?.();\n    }\n  };\n\n  /**\n   * Calcula el costo total de instalación (instalación + activación + modem)\n   * Este es el valor que se muestra en la UI según el diseño de referencia\n   */\n  private getTotalInstallationCost(option: ContractOption): number {\n    return option.installation + option.activation + option.modem;\n  }\n\n  /**\n   * Formatea la duración del contrato para mostrar en la card\n   * Ej: \"12 Meses de Contrato\", \"24 Meses de Contrato\", \"Sin contrato\"\n   */\n  private formatContractLabel(months: number): string {\n    if (months === 0) return 'Sin contrato';\n    return `${months} Meses de Contrato`;\n  }\n\n  // ------------------------------------------\n  // RENDER\n  // ------------------------------------------\n\n  render() {\n    const withContract = CONTRACT_OPTIONS.find(c => c.typeId === 1);\n    const withoutContract = CONTRACT_OPTIONS.find(c => c.typeId === 0);\n\n    return (\n      <Host>\n        <div class=\"step-contract\">\n          {/* Header */}\n          <header class=\"step-contract__header\">\n            <button class=\"step-contract__back-link\" onClick={this.onBack}>\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <polyline points=\"15 18 9 12 15 6\"></polyline>\n              </svg>\n              <span>Regresar</span>\n            </button>\n            <h1 class=\"step-contract__title\">Selecciona un tipo de contrato</h1>\n            <div class=\"step-contract__divider\"></div>\n          </header>\n\n          {/* Tabs */}\n          <div class=\"step-contract__tabs\">\n            <button\n              class={{\n                'step-contract__tab': true,\n                'step-contract__tab--active': this.activeTab === 1,\n              }}\n              onClick={() => this.handleTabChange(1)}\n            >\n              <span class=\"step-contract__tab-title\">Con contrato</span>\n              <span class=\"step-contract__tab-subtitle\">12 y 24 meses de contrato</span>\n            </button>\n            <button\n              class={{\n                'step-contract__tab': true,\n                'step-contract__tab--active': this.activeTab === 0,\n              }}\n              onClick={() => this.handleTabChange(0)}\n            >\n              <span class=\"step-contract__tab-title\">Sin contrato</span>\n              <span class=\"step-contract__tab-subtitle\">Plan mensual con pago por adelantado</span>\n            </button>\n          </div>\n\n          {/* Content */}\n          <div class=\"step-contract__content\">\n            {this.activeTab === 1 && withContract && (\n              <div class=\"step-contract__options\">\n                {withContract.contract.map((option) => {\n                  const totalCost = this.getTotalInstallationCost(option);\n                  return (\n                    <label\n                      class={{\n                        'step-contract__option': true,\n                        'step-contract__option--selected':\n                          this.selectedOption?.deadlines === option.deadlines &&\n                          this.selectedOption?.typeId === 1,\n                      }}\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"contract\"\n                        checked={\n                          this.selectedOption?.deadlines === option.deadlines &&\n                          this.selectedOption?.typeId === 1\n                        }\n                        onChange={() => this.handleSelectOption(1, option)}\n                      />\n                      <div class=\"step-contract__option-content\">\n                        <span class=\"step-contract__option-title\">\n                          {this.formatContractLabel(option.deadlines)}\n                        </span>\n                        <span class=\"step-contract__option-price\">\n                          Instalación: {totalCost > 0 ? formatPrice(totalCost) : '$0.00'}\n                        </span>\n                      </div>\n                    </label>\n                  );\n                })}\n              </div>\n            )}\n\n            {this.activeTab === 0 && withoutContract && (\n              <div class=\"step-contract__options step-contract__options--single\">\n                {withoutContract.contract.map((option) => {\n                  const totalCost = this.getTotalInstallationCost(option);\n                  return (\n                    <label\n                      class={{\n                        'step-contract__option': true,\n                        'step-contract__option--selected':\n                          this.selectedOption?.typeId === 0,\n                      }}\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"contract\"\n                        checked={this.selectedOption?.typeId === 0}\n                        onChange={() => this.handleSelectOption(0, option)}\n                      />\n                      <div class=\"step-contract__option-content\">\n                        <span class=\"step-contract__option-title\">Sin contrato</span>\n                        <span class=\"step-contract__option-price\">\n                          Instalación: {formatPrice(totalCost)}\n                        </span>\n                      </div>\n                    </label>\n                  );\n                })}\n              </div>\n            )}\n          </div>\n\n          {/* Continue Button */}\n          <div class=\"step-contract__actions\">\n            <button\n              class=\"step-contract__btn-continue\"\n              onClick={this.handleContinue}\n              disabled={!this.selectedOption}\n            >\n              Continuar\n            </button>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n"]}