{"version":3,"file":"step-confirmation.js","sourceRoot":"","sources":["../../../../src/components/steps/step-confirmation/step-confirmation.tsx"],"names":[],"mappings":"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","sourcesContent":["// ============================================\n// STEP CONFIRMATION - Confirmation/Result Step\n// Fixed Service Flow Web Component\n// Supports both Internet and CLARO HOGAR catalogue flows\n// ============================================\n\nimport { Component, Prop, State, h, Host } from '@stencil/core';\nimport { flowState, flowActions } from '../../../store/flow.store';\nimport { requestService, paymentService, cartService, productService, shippingService, plansService } from '../../../services';\nimport { FlowCompleteEvent } from '../../../store/interfaces';\nimport { SUCCESS_MESSAGES, ERROR_MESSAGES } from '../../../utils/constants';\n\n@Component({\n  tag: 'step-confirmation',\n  styleUrl: 'step-confirmation.scss',\n  shadow: true,\n})\nexport class StepConfirmation {\n  // ------------------------------------------\n  // PROPS\n  // ------------------------------------------\n\n  @Prop() onComplete: (event: FlowCompleteEvent) => void;\n  @Prop() onCancel: () => void;\n  @Prop() onBack: () => void;\n\n  // ------------------------------------------\n  // STATE\n  // ------------------------------------------\n\n  @State() status: 'loading' | 'success' | 'error' = 'loading';\n  @State() orderId: string | null = null;\n  @State() orderNumber: string | null = null;\n  @State() confirmationSent: boolean = false;\n  @State() errorMessage: string = '';\n\n  // ------------------------------------------\n  // LIFECYCLE\n  // ------------------------------------------\n\n  async componentWillLoad() {\n    // Check if this is a catalogue flow (CLARO HOGAR) or internet flow\n    // Catalogue flow: has payment result but no contract/formData\n    // Internet flow: has contract and formData\n    const isCatalogueFlow = this.isCatalogueFlow();\n\n    if (isCatalogueFlow) {\n      await this.handleCatalogueFlowConfirmation();\n    } else {\n      await this.submitRequest();\n    }\n  }\n\n  /**\n   * Determines if this is a catalogue/equipment flow (CLARO HOGAR)\n   * vs an internet service flow\n   */\n  private isCatalogueFlow(): boolean {\n    // Catalogue flow has payment result stored but no contract/formData\n    const paymentResult = paymentService.getPaymentResult();\n    const hasContract = !!flowState.selectedContract;\n    const hasFormData = !!flowState.formData;\n\n    // If we have payment result but no contract/formData, it's catalogue flow\n    return !!paymentResult && !hasContract && !hasFormData;\n  }\n\n  /**\n   * Handles confirmation for catalogue/equipment flow (CLARO HOGAR)\n   * The purchase is already complete after payment - just show success\n   */\n  private async handleCatalogueFlowConfirmation() {\n    this.status = 'loading';\n\n    try {\n      const paymentResult = paymentService.getPaymentResult();\n\n      if (!paymentResult || !paymentResult.success) {\n        throw new Error('No se encontró información del pago');\n      }\n\n      // Get order BAN from payment service\n      const orderBan = paymentService.getOrderBan();\n\n      // For catalogue flow, the orderId comes from the payment process\n      this.orderId = orderBan || paymentResult.operationId || null;\n\n      console.log('[StepConfirmation] Catalogue flow - payment success:', {\n        orderId: this.orderId,\n        operationId: paymentResult.operationId,\n        authorizationNumber: paymentResult.authorizationNumber,\n      });\n\n      // Mark as success\n      this.status = 'success';\n\n      // Store result\n      flowActions.setOrderResult(this.orderId, null);\n\n      // Emit complete event with available data\n      this.onComplete?.({\n        orderId: this.orderId!,\n        plan: flowState.selectedPlan!,\n        contract: null as any, // Not applicable for catalogue flow\n        customer: null as any, // Customer data came from shipping form\n        location: flowState.location!,\n      });\n\n    } catch (error) {\n      console.error('[StepConfirmation] Catalogue flow error:', error);\n      this.status = 'error';\n      this.errorMessage = error.message || ERROR_MESSAGES.REQUEST_ERROR;\n      flowActions.setOrderResult(null, this.errorMessage);\n    }\n  }\n\n  // ------------------------------------------\n  // METHODS\n  // ------------------------------------------\n\n  private async submitRequest() {\n    this.status = 'loading';\n\n    try {\n      const { location, plan, contract, formData } = {\n        location: flowState.location,\n        plan: flowState.selectedPlan,\n        contract: flowState.selectedContract,\n        formData: flowState.formData,\n      };\n\n      // Validate all data exists\n      const validation = requestService.validateSubmissionData(formData, contract, plan, location);\n\n      if (!validation.isValid) {\n        throw new Error(`Datos incompletos: ${validation.missingFields.join(', ')}`);\n      }\n\n      // Build and submit payload\n      const payload = requestService.buildPayload(formData!, contract!, plan!, location!);\n      const response = await requestService.submitRequest(payload);\n\n      if (response.hasError) {\n        throw new Error(response.errorDisplay || response.message || ERROR_MESSAGES.REQUEST_ERROR);\n      }\n\n      // Success - store orderId\n      this.orderId = response.orderId || null;\n\n      // Get order details (async, don't block on failure)\n      if (this.orderId) {\n        this.fetchOrderDetails(this.orderId);\n        // Send confirmation email (async, don't block on failure)\n        this.sendConfirmationEmail(this.orderId, formData!.personal.email);\n      }\n\n      // Mark as success\n      this.status = 'success';\n\n      // Store result\n      flowActions.setOrderResult(this.orderId, null);\n\n      // Emit complete event\n      this.onComplete?.({\n        orderId: this.orderId!,\n        plan: plan!,\n        contract: contract!,\n        customer: formData!,\n        location: location!,\n      });\n\n    } catch (error) {\n      console.error('Request submission failed:', error);\n      this.status = 'error';\n      this.errorMessage = error.message || ERROR_MESSAGES.REQUEST_ERROR;\n      flowActions.setOrderResult(null, this.errorMessage);\n    }\n  }\n\n  /**\n   * Fetches order details after successful submission\n   * Non-blocking - errors are logged but don't affect UI\n   */\n  private async fetchOrderDetails(orderId: string) {\n    try {\n      const orderDetails = await requestService.getOrder(orderId);\n      if (!orderDetails.hasError && orderDetails.orderNumber) {\n        this.orderNumber = orderDetails.orderNumber;\n      }\n    } catch (error) {\n      // Non-critical - just log the error\n      console.warn('Could not fetch order details:', error);\n    }\n  }\n\n  /**\n   * Sends confirmation email to customer\n   * Non-blocking - errors are logged but don't affect UI\n   */\n  private async sendConfirmationEmail(orderId: string, email: string) {\n    try {\n      const confirmationResult = await requestService.sendConfirmation(orderId, email);\n      if (!confirmationResult.hasError && confirmationResult.sent) {\n        this.confirmationSent = true;\n      }\n    } catch (error) {\n      // Non-critical - just log the error\n      console.warn('Could not send confirmation email:', error);\n    }\n  }\n\n  private handleRetry = () => {\n    this.submitRequest();\n  };\n\n  private handleClose = () => {\n    // Clear all sessionStorage data (following TEL pattern)\n    this.clearSessionStorage();\n\n    // Reset flow state\n    flowActions.resetFlow();\n\n    // Notify parent\n    this.onCancel?.();\n  };\n\n  /**\n   * Clears all flow-related sessionStorage keys\n   * Calls clear methods from all services and removes all known keys\n   */\n  private clearSessionStorage() {\n    console.log('[StepConfirmation] Clearing all sessionStorage data');\n\n    // Clear using service methods (they handle their own keys)\n    try {\n      cartService.clearCartSession();\n      productService.clearProductSession();\n      shippingService.clearShippingData();\n      paymentService.clearPaymentData();\n      plansService.clearPlan();\n      flowActions.clearToken();\n    } catch (e) {\n      console.warn('[StepConfirmation] Error clearing service data:', e);\n    }\n\n    // Also clear all known keys directly to ensure complete cleanup\n    const keysToRemove = [\n      // Token/Auth\n      'token',\n      'correlationId',\n      // Location data (Base64 encoded)\n      'latitud',\n      'longitud',\n      'planCodeInternet',\n      // Plan data\n      'plan',\n      'planId',\n      'planPrice',\n      // Contract data\n      'typeContractId',\n      'contractInstallment',\n      'contractInstallation',\n      'contractActivation',\n      'contractModen',\n      // Cart data\n      'cart',\n      'cartId',\n      'cartTotal',\n      'cartProducts',\n      'mainId',\n      'discountCoupon',\n      // Product data\n      'selectedProduct',\n      'productId',\n      'subcatalogId',\n      'selectedColor',\n      'selectedStorage',\n      'childrenId',\n      'parentId',\n      'deviceType',\n      // Shipping data\n      'shipmentId',\n      'zipCode',\n      'shippingAddress',\n      'deliveryMethod',\n      // Payment data\n      'orderBan',\n      'paymentResult',\n      // Legacy keys (TEL pattern)\n      'serviceLatitude',\n      'serviceLongitude',\n      'serviceAddress',\n      'serviceCity',\n      'serviceZipCode',\n      'serviceType',\n      'serviceMessage',\n      'planName',\n      'planSoc',\n      'planFeatures',\n      'customerFirstName',\n      'customerSecondName',\n      'customerLastName',\n      'customerSecondLastName',\n      'customerIdType',\n      'customerIdNumber',\n      'customerIdExpiration',\n      'customerPhone1',\n      'customerPhone2',\n      'customerEmail',\n      'customerBirthDate',\n      'businessName',\n      'businessPosition',\n      'isExistingCustomer',\n      'shoppingCart',\n    ];\n\n    keysToRemove.forEach(key => {\n      sessionStorage.removeItem(key);\n    });\n\n    console.log('[StepConfirmation] SessionStorage cleared successfully');\n  }\n\n  // ------------------------------------------\n  // RENDER\n  // ------------------------------------------\n\n  private renderLoading() {\n    return (\n      <div class=\"step-confirmation__loading\">\n        <div class=\"step-confirmation__spinner\"></div>\n        <p>Procesando tu solicitud...</p>\n      </div>\n    );\n  }\n\n  private renderSuccess() {\n    // Prefer orderNumber from getOrder API, fallback to orderId from submit response\n    const displayOrderId = this.orderNumber || this.orderId;\n\n    return (\n      <div class=\"step-confirmation__result step-confirmation__result--success\">\n        <div class=\"step-confirmation__icon step-confirmation__icon--success\">\n          <img src=\"/assets/images/ok-check.svg\" alt=\"Éxito\" />\n        </div>\n        <h2 class=\"step-confirmation__title step-confirmation__title--success\">{SUCCESS_MESSAGES.REQUEST_SUCCESS}</h2>\n        <p class=\"step-confirmation__message\">{SUCCESS_MESSAGES.REQUEST_SUCCESS_SUBTITLE}</p>\n        {displayOrderId && (\n          <p class=\"step-confirmation__order-id\">Número de orden: {displayOrderId}</p>\n        )}\n        {this.confirmationSent && (\n          <p class=\"step-confirmation__email-sent\">\n            Se ha enviado un correo de confirmación a tu email.\n          </p>\n        )}\n      </div>\n    );\n  }\n\n  private renderError() {\n    return (\n      <div class=\"step-confirmation__result step-confirmation__result--error\">\n        <div class=\"step-confirmation__icon step-confirmation__icon--error\">\n          <img src=\"/assets/images/error-check.svg\" alt=\"Error\" />\n        </div>\n        <h2 class=\"step-confirmation__title step-confirmation__title--error\">\n          ¡Lo sentimos, ha ocurrido un error en el proceso de solicitud!\n        </h2>\n        <p class=\"step-confirmation__message\">\n          En este momento estamos presentando inconvenientes en nuestro sistema.\n          <br />\n          Por favor, inténtalo nuevamente.\n        </p>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <Host>\n        <div class=\"step-confirmation\">\n          <header class=\"step-confirmation__header\">\n            <h1 class=\"step-confirmation__header-title\">Confirmación de Solicitud</h1>\n          </header>\n\n          <div class=\"step-confirmation__content\">\n            {this.status === 'loading' && this.renderLoading()}\n            {this.status === 'success' && this.renderSuccess()}\n            {this.status === 'error' && this.renderError()}\n          </div>\n\n          {this.status === 'success' && (\n            <div class=\"step-confirmation__actions\">\n              <button class=\"step-confirmation__btn\" onClick={this.handleClose}>\n                Cerrar\n              </button>\n            </div>\n          )}\n\n          {this.status === 'error' && (\n            <div class=\"step-confirmation__actions\">\n              <button class=\"step-confirmation__btn step-confirmation__btn--error\" onClick={this.handleRetry}>\n                Volver a intentar\n              </button>\n            </div>\n          )}\n        </div>\n      </Host>\n    );\n  }\n}\n"]}