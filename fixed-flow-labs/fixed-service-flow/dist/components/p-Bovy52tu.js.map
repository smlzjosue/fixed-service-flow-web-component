{"file":"p-Bovy52tu.js","mappings":"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","names":[],"sources":["src/services/catalogue.service.ts"],"sourcesContent":["// ============================================\n// CATALOGUE SERVICE - Product Catalogue for CLARO HOGAR\n// Fixed Service Flow Web Component\n// ============================================\n\nimport { httpService } from './http.service';\nimport { tokenService } from './token.service';\nimport { CatalogueResponse, CatalogueProduct, CatalogueFilter } from '../store/interfaces';\n\n// ------------------------------------------\n// INTERFACES\n// ------------------------------------------\n\ninterface ListCatalogueRequest {\n  catalogId: number;\n  pageNo: number;\n  pageItems: number;\n  creditClass: string;\n  orderBy: number;\n  news: number;\n  offers: string;\n  categoryID: string;\n  brand: string;\n  filter: string;\n  price: string;\n  labels: string[];\n}\n\n// API Response structure (matches TEL)\ninterface CatalogueApiResponse {\n  hasError: boolean;\n  message?: string;\n  errorDisplay?: string;\n  catalogs?: CatalogItem[];\n}\n\ninterface CatalogItem {\n  catalogId: number;\n  catalogName?: string;\n  catalog?: SubCatalogItem[];\n  products?: CatalogueProduct[];\n  brands?: any[];\n}\n\ninterface SubCatalogItem {\n  catalogId: number;\n  catalogName?: string;\n  products?: CatalogueProduct[];\n  brands?: any[];\n}\n\n// ------------------------------------------\n// CATALOGUE SERVICE CLASS\n// ------------------------------------------\n\nclass CatalogueService {\n  // Catalog IDs (from TEL API structure)\n  // catalogId 6 = Hogar (parent category)\n  // Subcategory 39 = Internet + Telefonía\n  // Subcategory 23 = Internet Inalámbrico\n  private readonly HOGAR_CATALOGUE_ID = 6;\n  private readonly DEFAULT_PAGE_ITEMS = 300;\n\n  // Filter values for selecting subcategory (used in our component)\n  // These are subcatalog IDs as strings for the filter component\n  readonly FILTER_INTERNET_TELEFONIA = '39';  // Subcatalog ID\n  readonly FILTER_INTERNET_INALAMBRICO = '23'; // Subcatalog ID\n\n  // ------------------------------------------\n  // LIST CATALOGUE\n  // ------------------------------------------\n\n  /**\n   * Fetches product catalogue for CLARO HOGAR (wireless internet devices)\n   * Endpoint: POST api/Catalogue/listCatalogue\n   *\n   * Response structure from API:\n   * {\n   *   hasError: false,\n   *   catalogs: [\n   *     { catalogId: 23, catalog: [{ catalogId: 1, products: [...] }, ...] }\n   *   ]\n   * }\n   */\n  async listCatalogue(\n    subcatalogId: string = this.FILTER_INTERNET_INALAMBRICO,\n    pageNo: number = 1,\n    searchText: string = '',\n    brand: string = '',\n    price: string = ''\n  ): Promise<CatalogueResponse> {\n    // Ensure token exists before making the call\n    await tokenService.ensureToken();\n\n    // Use parent catalog ID (Hogar = 6) and categoryID = \"0\" to get all subcategories\n    const request: ListCatalogueRequest = {\n      catalogId: this.HOGAR_CATALOGUE_ID, // Use Hogar (6) as parent\n      pageNo: pageNo,\n      pageItems: this.DEFAULT_PAGE_ITEMS,\n      creditClass: 'C',\n      orderBy: 7,\n      news: 0,\n      offers: '0',\n      categoryID: '0', // Get all subcategories\n      brand: brand,\n      filter: searchText,\n      price: price,\n      labels: [],\n    };\n\n    console.log('[CatalogueService] Request:', JSON.stringify(request));\n\n    const apiResponse = await httpService.post<CatalogueApiResponse>('api/Catalogue/listCatalogue', request);\n\n    console.log('[CatalogueService] API Response keys:', Object.keys(apiResponse || {}));\n\n    if (apiResponse.hasError) {\n      throw new Error(apiResponse.message || 'Failed to fetch catalogue');\n    }\n\n    // Parse products from the nested structure\n    // First find Hogar catalog, then find the requested subcatalog\n    const targetSubcatalogId = parseInt(subcatalogId, 10);\n    const products = this.extractProductsFromSubcatalog(apiResponse, this.HOGAR_CATALOGUE_ID, targetSubcatalogId);\n\n    console.log('[CatalogueService] Extracted products:', products.length);\n\n    return {\n      hasError: false,\n      products: products,\n      totalItems: products.length,\n    };\n  }\n\n  /**\n   * Extracts products from a specific subcatalog within the Hogar catalog\n   * Structure: catalogs[] -> find Hogar (6) -> catalog[] -> find subcatalog (23 or 39) -> products\n   */\n  private extractProductsFromSubcatalog(\n    response: CatalogueApiResponse,\n    parentCatalogId: number,\n    subcatalogId: number\n  ): CatalogueProduct[] {\n    if (!response.catalogs || !Array.isArray(response.catalogs)) {\n      console.log('[CatalogueService] No catalogs in response');\n      return [];\n    }\n\n    // Find the parent catalog (Hogar = 6)\n    const parentCatalog = response.catalogs.find(c => c.catalogId === parentCatalogId);\n\n    if (!parentCatalog) {\n      console.log('[CatalogueService] Parent catalog not found:', parentCatalogId);\n      // Try to find subcatalog directly in catalogs array\n      for (const catalog of response.catalogs) {\n        if (catalog.catalog) {\n          const subcatalog = catalog.catalog.find(sc => sc.catalogId === subcatalogId);\n          if (subcatalog) {\n            console.log('[CatalogueService] Found subcatalog in:', catalog.catalogId);\n            return subcatalog.products || [];\n          }\n        }\n      }\n      return [];\n    }\n\n    console.log('[CatalogueService] Found parent catalog:', parentCatalog.catalogId, parentCatalog.catalogName);\n\n    // Find the subcatalog within the parent\n    if (!parentCatalog.catalog || !Array.isArray(parentCatalog.catalog)) {\n      console.log('[CatalogueService] No subcatalogs in parent');\n      return parentCatalog.products || [];\n    }\n\n    const subcatalog = parentCatalog.catalog.find(sc => sc.catalogId === subcatalogId);\n\n    if (!subcatalog) {\n      console.log('[CatalogueService] Subcatalog not found:', subcatalogId);\n      console.log('[CatalogueService] Available subcatalogs:', parentCatalog.catalog.map(sc => ({ id: sc.catalogId, name: sc.catalogName })));\n      // Return first subcatalog's products as fallback\n      return parentCatalog.catalog[0]?.products || [];\n    }\n\n    console.log('[CatalogueService] Found subcatalog:', subcatalog.catalogId, subcatalog.catalogName);\n    return subcatalog.products || [];\n  }\n\n  /**\n   * BFS search for catalog by ID (matches TEL's findCatalogById)\n   * Reserved for future use with nested catalog navigation\n   */\n  // @ts-ignore: Reserved for future use\n  private _findCatalogById(catalogs: CatalogItem[], catalogId: number): CatalogItem | null {\n    const queue = [...catalogs];\n\n    while (queue.length > 0) {\n      const current = queue.shift()!;\n\n      if (current.catalogId === catalogId) {\n        return current;\n      }\n\n      if (current.catalog && current.catalog.length > 0) {\n        queue.push(...(current.catalog as CatalogItem[]));\n      }\n    }\n\n    return null;\n  }\n\n  // ------------------------------------------\n  // GET FILTERS\n  // ------------------------------------------\n\n  /**\n   * Returns the available product type filters\n   */\n  getProductTypeFilters(): CatalogueFilter[] {\n    return [\n      {\n        value: this.FILTER_INTERNET_TELEFONIA,\n        label: 'Internet + Telefonía',\n      },\n      {\n        value: this.FILTER_INTERNET_INALAMBRICO,\n        label: 'Internet Inalámbrico',\n      },\n    ];\n  }\n\n  // ------------------------------------------\n  // HELPER METHODS\n  // ------------------------------------------\n\n  /**\n   * Formats price for display (monthly installment)\n   */\n  formatInstallmentPrice(price: number): string {\n    return `$${price.toFixed(2)}/mes`;\n  }\n\n  /**\n   * Formats regular price\n   */\n  formatRegularPrice(price: number): string {\n    return `$${price.toFixed(2)}`;\n  }\n\n  /**\n   * Calculates monthly installment from total price\n   */\n  calculateInstallment(totalPrice: number, installments: number): number {\n    if (installments <= 0) return totalPrice;\n    return Number((totalPrice / installments).toFixed(2));\n  }\n\n  /**\n   * Cleans HTML from product description\n   */\n  cleanDescription(html: string): string {\n    if (!html) return '';\n    // Remove HTML tags\n    return html.replace(/<[^>]*>/g, '').trim();\n  }\n\n  /**\n   * Truncates text to max length with ellipsis\n   */\n  truncateText(text: string, maxLength: number = 80): string {\n    if (!text || text.length <= maxLength) return text;\n    return text.substring(0, maxLength).trim() + '...';\n  }\n\n  /**\n   * Parses product colors from API response\n   */\n  parseColors(colors: Array<{ webColor: string }> | undefined): string[] {\n    if (!colors || !Array.isArray(colors)) return [];\n    return colors.map(c => c.webColor).filter(Boolean);\n  }\n\n  /**\n   * Stores selected product in sessionStorage\n   */\n  storeProductInSession(product: CatalogueProduct): void {\n    try {\n      sessionStorage.setItem('selectedProduct', JSON.stringify(product));\n      sessionStorage.setItem('productId', String(product.productId));\n    } catch (e) {\n      console.error('[CatalogueService] Error storing product in session:', e);\n    }\n  }\n\n  /**\n   * Gets stored product from sessionStorage\n   */\n  getStoredProduct(): CatalogueProduct | null {\n    try {\n      const data = sessionStorage.getItem('selectedProduct');\n      return data ? JSON.parse(data) : null;\n    } catch {\n      return null;\n    }\n  }\n\n  /**\n   * Clears product from session\n   */\n  clearProduct(): void {\n    sessionStorage.removeItem('selectedProduct');\n    sessionStorage.removeItem('productId');\n  }\n}\n\n// ------------------------------------------\n// SINGLETON EXPORT\n// ------------------------------------------\n\nexport const catalogueService = new CatalogueService();\nexport default catalogueService;\n"],"version":3}