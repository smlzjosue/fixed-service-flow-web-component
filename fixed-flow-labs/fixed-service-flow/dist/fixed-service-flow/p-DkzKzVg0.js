import{t as r,h as e}from"./p-CNBAjIjF.js";import{a as t}from"./p-BmMai6aX.js";const a={ORDER_BAN:"orderBan",PAYMENT_RESULT:"paymentResult"};class n{paymentIframeUrl="";setPaymentIframeUrl(r){this.paymentIframeUrl=r}getPaymentIframeUrl(){return this.paymentIframeUrl}async createOrder(t){const a=r.getToken();const n=new FormData;n.append("token",a);n.append("flowId",t.flowId);n.append("frontFlowId",t.frontFlowId);n.append("frontFlowName",t.frontFlowName);n.append("banExisting",t.banExisting||"");n.append("subscriberExisting",t.subscriberExisting||"");n.append("amount",t.amount);n.append("email",t.email);n.append("zipCode",t.zipCode);n.append("deposit",t.deposit);n.append("pastDueAmount",t.pastDueAmount||"0");try{const r=await e.postFormData("api/Orders/creationOfOrder",n);if(!r.hasError&&r.ban){this.storeOrderBan(r.ban)}return r}catch(r){console.error("[PaymentService] Create order error:",r);return{hasError:true,errorDisplay:"Error al crear la orden"}}}async recordPayment(t){const a=r.getToken();const n=new FormData;n.append("token",a);n.append("ban",t.ban);n.append("cardNumber",t.cardNumber);n.append("cardType",t.cardType);n.append("authorizationNumber",t.authorizationNumber);n.append("referenceNumber",t.referenceNumber);n.append("description",t.description);n.append("operationId",t.operationId);n.append("amount",t.amount);n.append("deposit",t.deposit);try{const r=await e.postFormData("api/Payment/record",n);return r}catch(r){console.error("[PaymentService] Record payment error:",r);return{hasError:true,errorDisplay:"Error al registrar el pago"}}}async recordPaymentError(t,a,n,o,s,m,c,i){const y=r.getToken();const u=new FormData;u.append("token",y);u.append("ban",t);u.append("subscriber",a);u.append("description",n);u.append("operationId",o);u.append("deposit",s);u.append("cardType",m);u.append("cardNumber",c);u.append("amount",i);try{return await e.postFormData("api/Payment/error",u)}catch(r){console.error("[PaymentService] Record error error:",r);return{hasError:true}}}async getPaymentIframe(r){try{const t=await e.post("api/Payment/getPaymentIframe",r);return t}catch(r){console.error("[PaymentService] Get iframe error:",r);return{errorInfo:{hasError:true,errorDisplay:"Error al obtener el iframe de pago"}}}}storeOrderBan(r){t.set(a.ORDER_BAN,r)}getOrderBan(){return t.get(a.ORDER_BAN)||""}storePaymentResult(r){t.setJSON(a.PAYMENT_RESULT,r)}getPaymentResult(){return t.getJSON(a.PAYMENT_RESULT)}clearPaymentData(){t.remove(a.ORDER_BAN);t.remove(a.PAYMENT_RESULT)}buildPaymentItems(r){const e=[];if(r.depositAmount&&r.depositAmount>0){e.push({paymentType:"DEPOSIT",amount:r.depositAmount})}if(r.totalDownPayment&&r.totalDownPayment>0){e.push({paymentType:"DOWNPAYMENT",amount:r.totalDownPayment})}if(r.totalTax&&r.totalTax>0){const t=(r.totalPrice||0)-(r.depositAmount||0)-(r.totalDownPayment||0)-(r.installmentAmount||0);if(t>0){e.push({paymentType:"TAXES",amount:Number(t.toFixed(2))})}}if(r.cartUpdateResponse?.acceletartedAmount){e.push({paymentType:"INSTALLMENT",amount:r.cartUpdateResponse.acceletartedAmount})}return e}calculateTotalAmount(r){return r.reduce(((r,e)=>r+e.amount),0)}}const o=new n;export{o as p};
//# sourceMappingURL=p-DkzKzVg0.js.map