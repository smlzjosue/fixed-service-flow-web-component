import{t as r,h as e}from"./p-CNBAjIjF.js";const t={CART:"cart",CART_ID:"cartId",MAIN_ID:"mainId",DISCOUNT_COUPON:"discountCoupon",CART_TOTAL:"cartTotal",CART_PRODUCTS:"cartProducts"};const o={HOME:6};const a="C";class n{async getCart(t=""){try{await r.ensureToken();const o=t||this.getDiscountCoupon()||"";const a={promoCode:o};console.log("[CartService] Getting cart with promo:",o||"none");const n=await e.post("api/Card/getCart",a);if(n.hasError){console.error("[CartService] API error:",n.message);return{hasError:true,message:n.message||"Error al obtener el carrito",errorDisplay:n.errorDisplay}}this.storeCartInSession(n);return n}catch(r){console.error("[CartService] Exception:",r);return{hasError:true,message:"Error de conexi贸n al obtener el carrito"}}}async addToCart(t,n,c=1,s,i){try{await r.ensureToken();const l=r.getToken()||"";const d={token:l,productId:String(t.productId),notificationDetailID:0,chvSource:"",promoCode:"",installments:n,decPrice:t.update_price||0,decDeposit:0,decDownPayment:t.decDownPayment||0,decTotalPrice:t.regular_price||0,Qty:c,flowId:o.HOME,ssoToken:"",userID:"0",parentProductId:i||0,parentCartId:s||0,creditClass:a,downgradeAllowed:false,pendingAccelerated:0,acceletartedAmount:0,pastDueAmount:0,delicuency:false};const u=JSON.stringify([d]);const C={cartItems:u};console.log("[CartService] Adding to cart:",t.productName);console.log("[CartService] Request payload:",C);const g=await e.post("api/Card/addToCart",C);if(g.hasError){console.error("[CartService] Add to cart error:",g.message);return{code:0,hasError:true,message:g.message||"Error al agregar al carrito",errorDisplay:g.errorDisplay}}if(g.code){this.storeMainId(g.code)}console.log("[CartService] Added to cart, mainId:",g.code);return g}catch(r){console.error("[CartService] Exception:",r);return{code:0,hasError:true,message:"Error de conexi贸n al agregar al carrito"}}}async addPlanToCart(t,n,c){try{await r.ensureToken();const s=r.getToken()||"";const i={token:s,productId:String(t.planId),notificationDetailID:0,chvSource:"",promoCode:"",installments:1,decPrice:t.decSalePrice||t.decPrice,decDeposit:0,decDownPayment:0,decTotalPrice:t.decPrice,Qty:1,flowId:o.HOME,ssoToken:"",userID:"0",parentProductId:c,parentCartId:n,creditClass:a,downgradeAllowed:false,pendingAccelerated:0,acceletartedAmount:0,pastDueAmount:0,delicuency:false};const l=JSON.stringify([i]);const d={cartItems:l};console.log("[CartService] Adding plan to cart:",t.planName);const u=await e.post("api/Card/addToCart",d);if(u.hasError){console.error("[CartService] Add plan error:",u.message);return{code:0,hasError:true,message:u.message||"Error al agregar el plan",errorDisplay:u.errorDisplay}}console.log("[CartService] Plan added to cart");return u}catch(r){console.error("[CartService] Exception:",r);return{code:0,hasError:true,message:"Error de conexi贸n al agregar el plan"}}}async deleteItem(t,o){try{await r.ensureToken();const a={cartId:t,productId:o};console.log("[CartService] Deleting item:",t,o);const n=await e.post("api/Card/deleteItem",a);if(n.hasError){console.error("[CartService] Delete error:",n.message);return{hasError:true,message:n.message||"Error al eliminar del carrito"}}console.log("[CartService] Item deleted successfully");return{hasError:false}}catch(r){console.error("[CartService] Exception:",r);return{hasError:true,message:"Error de conexi贸n al eliminar del carrito"}}}async clearCart(){try{const r=await this.getCart();if(r.hasError||!r.products?.length){return{hasError:false}}for(const e of r.products){const r=await this.deleteItem(e.cartId,e.productId);if(r.hasError){return r}}this.clearCartSession();return{hasError:false}}catch(r){console.error("[CartService] Clear cart error:",r);return{hasError:true,message:"Error al limpiar el carrito"}}}storeCartInSession(r){try{sessionStorage.setItem(t.CART,JSON.stringify(r));if(r.totalPrice!==undefined){sessionStorage.setItem(t.CART_TOTAL,String(r.totalPrice))}if(r.products){sessionStorage.setItem(t.CART_PRODUCTS,JSON.stringify(r.products))}}catch(r){console.error("[CartService] Error storing cart:",r)}}getCachedCart(){try{const r=sessionStorage.getItem(t.CART);return r?JSON.parse(r):null}catch{return null}}storeMainId(r){try{sessionStorage.setItem(t.MAIN_ID,String(r))}catch(r){console.error("[CartService] Error storing mainId:",r)}}getMainId(){try{const r=sessionStorage.getItem(t.MAIN_ID);return r?parseInt(r,10):null}catch{return null}}storeDiscountCoupon(r){try{sessionStorage.setItem(t.DISCOUNT_COUPON,r)}catch(r){console.error("[CartService] Error storing coupon:",r)}}getDiscountCoupon(){try{return sessionStorage.getItem(t.DISCOUNT_COUPON)}catch{return null}}clearDiscountCoupon(){try{sessionStorage.removeItem(t.DISCOUNT_COUPON)}catch(r){console.error("[CartService] Error clearing coupon:",r)}}clearCartSession(){try{Object.values(t).forEach((r=>{sessionStorage.removeItem(r)}));console.log("[CartService] Cleared cart session")}catch(r){console.error("[CartService] Error clearing session:",r)}}calculateTotals(r){let e=0;let t=0;r.forEach((r=>{e+=(r.decPrice||0)*r.qty;t+=(r.decTotalPerMonth||r.decPrice||0)*r.qty}));const o=.115;const a=e*o;const n=e+a;return{subtotal:Number(e.toFixed(2)),tax:Number(a.toFixed(2)),total:Number(n.toFixed(2)),monthlyPayment:Number(t.toFixed(2))}}getEquipmentItems(r){return r.filter((r=>r.equipment===true||r.home===true))}getPlanItems(r){return r.filter((r=>r.plan===true))}hasEquipment(r){return r.some((r=>r.equipment===true||r.home===true))}hasPlan(r){return r.some((r=>r.plan===true))}getItemCount(r){return r.reduce(((r,e)=>r+e.qty),0)}formatPrice(r){return`$${r.toFixed(2)}`}}const c=new n;export{c};
//# sourceMappingURL=p-Cu1hlKnH.js.map