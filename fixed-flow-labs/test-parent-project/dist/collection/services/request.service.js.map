{"version":3,"file":"request.service.js","sourceRoot":"","sources":["../../src/services/request.service.ts"],"names":[],"mappings":"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","sourcesContent":["// ============================================\n// REQUEST SERVICE - Service Request Submission\n// Fixed Service Flow Web Component\n// ============================================\n\nimport { httpService } from './http.service';\nimport { tokenService } from './token.service';\nimport {\n  RequestResponse,\n  OrderDetailsResponse,\n  ConfirmationResponse,\n  ServiceRequestPayload,\n  FormData as CustomerFormData,\n  SelectedContract,\n  Plan,\n  LocationData,\n} from '../store/interfaces';\n\n// ------------------------------------------\n// REQUEST SERVICE CLASS\n// ------------------------------------------\n\nclass RequestService {\n  // ------------------------------------------\n  // SUBMIT REQUEST\n  // ------------------------------------------\n\n  /**\n   * Submits the service request\n   * Endpoint: POST api/Orders/internetServiceRequest\n   */\n  async submitRequest(payload: ServiceRequestPayload): Promise<RequestResponse> {\n    // Ensure token exists before making the call\n    await tokenService.ensureToken();\n\n    // Build FormData\n    const formData = new FormData();\n\n    // Add all fields to FormData\n    Object.entries(payload).forEach(([key, value]) => {\n      if (value !== undefined && value !== null) {\n        formData.append(key, String(value));\n      }\n    });\n\n    const response = await httpService.postFormData<RequestResponse>(\n      'api/Orders/internetServiceRequest',\n      formData,\n    );\n\n    return response;\n  }\n\n  // ------------------------------------------\n  // GET ORDER DETAILS\n  // ------------------------------------------\n\n  /**\n   * Gets order details after successful submission\n   * Endpoint: GET api/Orders/getOrder?orderId={orderId}\n   * Source: TEL - frontend/src/app/internet/services/plans.service.ts\n   */\n  async getOrder(orderId: string): Promise<OrderDetailsResponse> {\n    await tokenService.ensureToken();\n\n    const response = await httpService.get<OrderDetailsResponse>(\n      `api/Orders/getOrder?orderId=${encodeURIComponent(orderId)}`,\n    );\n\n    return response;\n  }\n\n  // ------------------------------------------\n  // SEND CONFIRMATION EMAIL\n  // ------------------------------------------\n\n  /**\n   * Sends confirmation email to customer\n   * Endpoint: POST api/Orders/sendConfirmation\n   * Source: TEL - frontend/src/app/internet/services/plans.service.ts\n   */\n  async sendConfirmation(orderId: string, email: string): Promise<ConfirmationResponse> {\n    await tokenService.ensureToken();\n\n    const formData = new FormData();\n    formData.append('orderId', orderId);\n    formData.append('email', email);\n\n    const response = await httpService.postFormData<ConfirmationResponse>(\n      'api/Orders/sendConfirmation',\n      formData,\n    );\n\n    return response;\n  }\n\n  // ------------------------------------------\n  // BUILD PAYLOAD\n  // ------------------------------------------\n\n  /**\n   * Builds the request payload from flow data\n   */\n  buildPayload(\n    formData: CustomerFormData,\n    contract: SelectedContract,\n    plan: Plan,\n    location: LocationData,\n  ): ServiceRequestPayload {\n    return {\n      // Contract type\n      type: contract.typeId,\n\n      // Personal data\n      name: formData.personal.firstName,\n      second_name: formData.personal.secondName || '',\n      last_name: formData.personal.lastName,\n      second_surname: formData.personal.secondLastName,\n      // date_birth: Campo requerido por el backend pero no recolectado en el formulario empresarial.\n      // Se env√≠a fecha por defecto. TODO: Discutir con backend si es necesario para flujo empresarial.\n      date_birth: formData.personal.birthDate || '1990-01-01',\n      email: formData.personal.email,\n      telephone1: formData.personal.phone1,\n      telephone2: formData.personal.phone2 || '',\n\n      // Address\n      zipCode: formData.address.zipCode,\n      address: formData.address.address,\n      city: formData.address.city,\n\n      // Identification\n      id_type: formData.personal.identificationType === 'license' ? '1' : '2',\n      id: formData.personal.identificationNumber,\n      identification_expiration: formData.personal.identificationExpiration,\n\n      // Flow tracking\n      frontFlowId: this.generateFlowId(),\n\n      // Plan details\n      plan_id: String(plan.planId),\n      plan_name: plan.planName,\n\n      // Contract details\n      deadlines: String(contract.deadlines),\n      installation: String(contract.installation),\n      activation: String(contract.activation),\n      moden: String(contract.modem),\n\n      // Customer status - Backend espera booleano, no string\n      claro_customer: formData.isExistingCustomer,\n\n      // Location\n      latitud: String(location.latitude),\n      longitud: String(location.longitude),\n\n      // Business data (optional)\n      business_name: formData.business.businessName,\n      business_position: formData.business.position,\n    };\n  }\n\n  // ------------------------------------------\n  // HELPER METHODS\n  // ------------------------------------------\n\n  /**\n   * Generates a unique flow ID for tracking\n   */\n  private generateFlowId(): string {\n    return `FSF-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Validates that all required data is present before submission\n   */\n  validateSubmissionData(\n    formData: CustomerFormData | null,\n    contract: SelectedContract | null,\n    plan: Plan | null,\n    location: LocationData | null,\n  ): { isValid: boolean; missingFields: string[] } {\n    const missingFields: string[] = [];\n\n    if (!location) {\n      missingFields.push('location');\n    }\n\n    if (!plan) {\n      missingFields.push('plan');\n    }\n\n    if (!contract) {\n      missingFields.push('contract');\n    }\n\n    if (!formData) {\n      missingFields.push('formData');\n    } else {\n      // Validate personal data\n      if (!formData.personal.firstName) missingFields.push('firstName');\n      if (!formData.personal.lastName) missingFields.push('lastName');\n      if (!formData.personal.secondLastName) missingFields.push('secondLastName');\n      if (!formData.personal.identificationNumber) missingFields.push('identificationNumber');\n      if (!formData.personal.identificationExpiration) missingFields.push('identificationExpiration');\n      if (!formData.personal.phone1) missingFields.push('phone1');\n      if (!formData.personal.email) missingFields.push('email');\n\n      // Validate business data\n      if (!formData.business.businessName) missingFields.push('businessName');\n      if (!formData.business.position) missingFields.push('position');\n\n      // Validate address\n      if (!formData.address.address) missingFields.push('address');\n      if (!formData.address.city) missingFields.push('city');\n      if (!formData.address.zipCode) missingFields.push('zipCode');\n    }\n\n    return {\n      isValid: missingFields.length === 0,\n      missingFields,\n    };\n  }\n}\n\n// ------------------------------------------\n// SINGLETON EXPORT\n// ------------------------------------------\n\nexport const requestService = new RequestService();\nexport default requestService;\n"]}