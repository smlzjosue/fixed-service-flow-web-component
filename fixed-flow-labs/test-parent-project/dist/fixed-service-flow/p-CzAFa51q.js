import{t as e,h as r}from"./p-CNBAjIjF.js";class t{HOGAR_CATALOGUE_ID=6;DEFAULT_PAGE_ITEMS=300;FILTER_INTERNET_TELEFONIA="39";FILTER_INTERNET_INALAMBRICO="23";async listCatalogue(t=this.FILTER_INTERNET_INALAMBRICO,o=1,c="",n="",s=""){await e.ensureToken();const a={catalogId:this.HOGAR_CATALOGUE_ID,pageNo:o,pageItems:this.DEFAULT_PAGE_ITEMS,creditClass:"C",orderBy:7,news:0,offers:"0",categoryID:"0",brand:n,filter:c,price:s,labels:[]};console.log("[CatalogueService] Request:",JSON.stringify(a));const i=await r.post("api/Catalogue/listCatalogue",a);console.log("[CatalogueService] API Response keys:",Object.keys(i||{}));if(i.hasError){throw new Error(i.message||"Failed to fetch catalogue")}const l=parseInt(t,10);const u=this.extractProductsFromSubcatalog(i,this.HOGAR_CATALOGUE_ID,l);console.log("[CatalogueService] Extracted products:",u.length);return{hasError:false,products:u,totalItems:u.length}}extractProductsFromSubcatalog(e,r,t){if(!e.catalogs||!Array.isArray(e.catalogs)){console.log("[CatalogueService] No catalogs in response");return[]}const o=e.catalogs.find((e=>e.catalogId===r));if(!o){console.log("[CatalogueService] Parent catalog not found:",r);for(const r of e.catalogs){if(r.catalog){const e=r.catalog.find((e=>e.catalogId===t));if(e){console.log("[CatalogueService] Found subcatalog in:",r.catalogId);return e.products||[]}}}return[]}console.log("[CatalogueService] Found parent catalog:",o.catalogId,o.catalogName);if(!o.catalog||!Array.isArray(o.catalog)){console.log("[CatalogueService] No subcatalogs in parent");return o.products||[]}const c=o.catalog.find((e=>e.catalogId===t));if(!c){console.log("[CatalogueService] Subcatalog not found:",t);console.log("[CatalogueService] Available subcatalogs:",o.catalog.map((e=>({id:e.catalogId,name:e.catalogName}))));return o.catalog[0]?.products||[]}console.log("[CatalogueService] Found subcatalog:",c.catalogId,c.catalogName);return c.products||[]}_findCatalogById(e,r){const t=[...e];while(t.length>0){const e=t.shift();if(e.catalogId===r){return e}if(e.catalog&&e.catalog.length>0){t.push(...e.catalog)}}return null}getProductTypeFilters(){return[{value:this.FILTER_INTERNET_TELEFONIA,label:"Internet + Telefonía"},{value:this.FILTER_INTERNET_INALAMBRICO,label:"Internet Inalámbrico"}]}formatInstallmentPrice(e){return`$${e.toFixed(2)}/mes`}formatRegularPrice(e){return`$${e.toFixed(2)}`}calculateInstallment(e,r){if(r<=0)return e;return Number((e/r).toFixed(2))}cleanDescription(e){if(!e)return"";return e.replace(/<[^>]*>/g,"").trim()}truncateText(e,r=80){if(!e||e.length<=r)return e;return e.substring(0,r).trim()+"..."}parseColors(e){if(!e||!Array.isArray(e))return[];return e.map((e=>e.webColor)).filter(Boolean)}storeProductInSession(e){try{sessionStorage.setItem("selectedProduct",JSON.stringify(e));sessionStorage.setItem("productId",String(e.productId))}catch(e){console.error("[CatalogueService] Error storing product in session:",e)}}getStoredProduct(){try{const e=sessionStorage.getItem("selectedProduct");return e?JSON.parse(e):null}catch{return null}}clearProduct(){sessionStorage.removeItem("selectedProduct");sessionStorage.removeItem("productId")}}const o=new t;const c={SELECTED_PRODUCT:"selectedProduct",PRODUCT_ID:"productId",MAIN_ID:"mainId",CHILDREN_ID:"childrenId",PARENT_ID:"parentId",DEVICE_TYPE:"deviceType",SELECTED_COLOR:"selectedColor",SELECTED_STORAGE:"selectedStorage",SUBCATALOG_ID:"subcatalogId"};const n=1;class s{extractStockAndImagesFromColors(e){const r=[];let t=undefined;let o=undefined;let c=false;if(!e||e.length===0){console.log("[ProductService] No colors array in response, stock will be undefined");return{stock:t,images:r,childrenId:o}}for(let s=0;s<e.length;s++){const a=e[s];if(!a.storages||a.storages.length===0)continue;for(let e=0;e<a.storages.length;e++){const s=a.storages[e];if(!s.products||s.products.length===0)continue;const i=s.products[0];if(a.defaultColor&&s.defaultStorage){if(i.stock!==undefined&&i.stock>n){t=i.stock;o=i.productId;c=true;if(i.imgUrl)r.push(i.imgUrl);if(i.side_image)r.push(i.side_image);if(i.back_image)r.push(i.back_image);console.log("[ProductService] Found default with stock:",t,"childrenId:",o);break}}}if(c)break}if(!c){for(let s=0;s<e.length;s++){const a=e[s];if(!a.storages||a.storages.length===0)continue;for(let e=0;e<a.storages.length;e++){const s=a.storages[e];if(!s.products||s.products.length===0)continue;const i=s.products[0];if(i.stock!==undefined&&i.stock>n){t=i.stock;o=i.productId;c=true;if(i.imgUrl)r.push(i.imgUrl);if(i.side_image)r.push(i.side_image);if(i.back_image)r.push(i.back_image);console.log("[ProductService] Found any with stock:",t,"childrenId:",o);break}}if(c)break}}if(t===undefined&&e.length>0){const c=e[0];if(c.storages&&c.storages.length>0){const e=c.storages[0];if(e.products&&e.products.length>0){const c=e.products[0];t=c.stock;o=c.productId;if(c.imgUrl)r.push(c.imgUrl);if(c.side_image)r.push(c.side_image);if(c.back_image)r.push(c.back_image);console.log("[ProductService] Using first product stock:",t,"childrenId:",o)}}}return{stock:t,images:r,childrenId:o}}async getEquipmentDetail(t){try{await e.ensureToken();const o=e.getToken()||"";const c={productId:t,userID:0,token:o};console.log("[ProductService] Fetching equipment detail:",t);const n=await r.post("api/Catalogue/equipmentDetail",c);if(n.hasError){console.error("[ProductService] API error:",n.message);return{hasError:true,message:n.message||"Error al cargar el detalle del producto",errorDisplay:n.errorDisplay}}const{stock:s,images:a,childrenId:i}=this.extractStockAndImagesFromColors(n.colors);const l=[];if(n.imgUrl)l.push(n.imgUrl);if(n.detailImage&&n.detailImage!==n.imgUrl){l.push(n.detailImage)}a.forEach((e=>{if(e&&!l.includes(e)){l.push(e)}}));if(n.images?.length){n.images.forEach((e=>{if(e&&!l.includes(e)){l.push(e)}}))}const u=s!==undefined?s:n.stock;const d={productId:n.productId||t,productName:n.productName||"",brandName:n.brandName,imgUrl:n.imgUrl||"",detailImage:n.detailImage,images:l.length>0?l:undefined,shortDescription:n.shortDescription,longDescription:n.longDescription,regular_price:n.regular_price||0,update_price:n.update_price||0,installments:n.installments||0,decDownPayment:n.decDownPayment,decDeposit:n.decDeposit,creditClass:n.creditClass,colors:n.colors,storages:n.storages,specifications:n.specifications,features:n.features,catalogId:n.catalogId,home:n.home,stock:u};console.log("[ProductService] Product stock from nested structure:",s,"root:",n.stock,"final:",u);if(i){this.storeChildrenId(i);console.log("[ProductService] Stored childrenId from colors:",i)}this.storeMainId(t);return{hasError:false,product:d}}catch(e){console.error("[ProductService] Exception:",e);return{hasError:true,message:"Error de conexión al cargar el detalle del producto"}}}storeMainId(e){try{sessionStorage.setItem(c.MAIN_ID,String(e));console.log("[ProductService] Stored mainId:",e)}catch(e){console.error("[ProductService] Error storing mainId:",e)}}getMainId(){try{const e=sessionStorage.getItem(c.MAIN_ID);return e?parseInt(e,10):null}catch{return null}}storeSelectedProduct(e,r){try{sessionStorage.setItem(c.SELECTED_PRODUCT,JSON.stringify(e));sessionStorage.setItem(c.PRODUCT_ID,String(e.productId));if(r){sessionStorage.setItem(c.SUBCATALOG_ID,String(r));console.log("[ProductService] Stored subcatalogId:",r)}console.log("[ProductService] Stored selected product:",e.productName)}catch(e){console.error("[ProductService] Error storing product:",e)}}storeSubcatalogId(e){try{sessionStorage.setItem(c.SUBCATALOG_ID,String(e));console.log("[ProductService] Stored subcatalogId:",e)}catch(e){console.error("[ProductService] Error storing subcatalogId:",e)}}getSubcatalogId(){try{const e=sessionStorage.getItem(c.SUBCATALOG_ID);return e?parseInt(e,10):0}catch{return 0}}getSelectedProduct(){try{const e=sessionStorage.getItem(c.SELECTED_PRODUCT);return e?JSON.parse(e):null}catch{return null}}getProductId(){try{const e=sessionStorage.getItem(c.PRODUCT_ID);return e?parseInt(e,10):null}catch{return null}}storeSelectedColor(e,r,t){try{const o={colorId:e,colorName:r,webColor:t};sessionStorage.setItem(c.SELECTED_COLOR,JSON.stringify(o))}catch(e){console.error("[ProductService] Error storing color:",e)}}getSelectedColor(){try{const e=sessionStorage.getItem(c.SELECTED_COLOR);return e?JSON.parse(e):null}catch{return null}}storeSelectedStorage(e,r){try{const t={storageId:e,storageName:r};sessionStorage.setItem(c.SELECTED_STORAGE,JSON.stringify(t))}catch(e){console.error("[ProductService] Error storing storage:",e)}}getSelectedStorage(){try{const e=sessionStorage.getItem(c.SELECTED_STORAGE);return e?JSON.parse(e):null}catch{return null}}storeChildrenId(e){try{sessionStorage.setItem(c.CHILDREN_ID,String(e))}catch(e){console.error("[ProductService] Error storing childrenId:",e)}}getChildrenId(){try{const e=sessionStorage.getItem(c.CHILDREN_ID);return e?parseInt(e,10):null}catch{return null}}storeParentId(e){try{sessionStorage.setItem(c.PARENT_ID,String(e))}catch(e){console.error("[ProductService] Error storing parentId:",e)}}getParentId(){try{const e=sessionStorage.getItem(c.PARENT_ID);return e?parseInt(e,10):null}catch{return null}}storeDeviceType(e){try{sessionStorage.setItem(c.DEVICE_TYPE,e)}catch(e){console.error("[ProductService] Error storing deviceType:",e)}}getDeviceType(){try{return sessionStorage.getItem(c.DEVICE_TYPE)}catch{return null}}clearProductSession(){try{Object.values(c).forEach((e=>{sessionStorage.removeItem(e)}));console.log("[ProductService] Cleared product session")}catch(e){console.error("[ProductService] Error clearing session:",e)}}formatPrice(e){return`$${e.toFixed(2)}`}formatInstallmentPrice(e){return`$${e.toFixed(2)}/mes`}calculateInstallment(e,r){if(r<=0)return e;return Number((e/r).toFixed(2))}cleanDescription(e){if(!e)return"";return e.replace(/<[^>]*>/g,"").trim()}isHomeProduct(e){return e.home===true||e.catalogId===6}}const a=new s;export{o as c,a as p};
//# sourceMappingURL=p-CzAFa51q.js.map